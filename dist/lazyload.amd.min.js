define((function(){"use strict";function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function s(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}return function(){function r(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),t(this,"setSizesAttribute",(function(e){e.dataset.sizes&&"auto"===e.dataset.sizes&&e.setAttribute("sizes","".concat(e.clientWidth,"px"))})),t(this,"loadImage",(function(e){var t=e;return new Promise((function(s,r){e.dataset.src&&(t.src=e.dataset.src),t.dataset.srcset&&t.setAttribute("srcset",e.dataset.srcset),t.onload=function(){s(t)},t.onerror=function(){r(t)}}))})),this.options=function(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?s(Object(n),!0).forEach((function(s){t(e,s,n[s])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({elements:".lazy",loadClass:"lazy-loading",loadedClass:"lazy-loaded",errorClass:"lazy-load-error",init:!0},e),this.elements=this.getElements(),this.options.init&&this.init()}var n,i,o;return n=r,(i=[{key:"getElements",value:function(){var e,t=this.options.elements;return"string"==typeof t&&(t=document.querySelectorAll(t)),e=t,Array.isArray(e)?e:Array.prototype.slice.call(e)}},{key:"createIntersectionObserver",value:function(){var e=this;window.IntersectionObserver&&(this.intersectionObserver=new IntersectionObserver((function(t,s){e.isIntersectingHandler(t,s)})))}},{key:"updateIntersectionObserver",value:function(e){var t=this;this.intersectionObserver&&e.forEach((function(e){e.classList.contains(t.options.loadedClass)||t.intersectionObserver.observe(e)}))}},{key:"resetIntersectionObserver",value:function(){var e=this;this.intersectionObserver&&this.elements.forEach((function(t){return e.intersectionObserver.unobserve(t)}))}},{key:"destroyIntersectionObserver",value:function(){this.resetIntersectionObserver(),delete this.intersectionObserver}},{key:"isIntersectingHandler",value:function(e,t){var s=this,r=e.reduce((function(e,r){var n,i;return r.isIntersecting&&(e.push(r.target),t.unobserve(r.target),s.elements=(n=s.elements,i=r.target,n.filter((function(e){return e!==i})))),e}),[]);this.loadImages(r)}},{key:"loadImages",value:function(e){var t=this;this.beforeLoad(e);var s=this.promiseMap(e);Promise.all(s).then((function(e){t.promiseStatusFilter(e)}))}},{key:"beforeLoad",value:function(e){var t=this;e.forEach((function(e){e.classList.add(t.options.loadClass),t.setSizesAttribute(e)}))}},{key:"promiseMap",value:function(e){var t=this;return e.map((function(e){return t.loadImage(e).then((function(e){return{status:"fulfilled",value:e}}),(function(e){return{status:"rejected",reason:e}}))}))}},{key:"promiseStatusFilter",value:function(e){var t=[],s=[];e.forEach((function(e){"fulfilled"===e.status&&t.push(e.value),"rejected"===e.status&&s.push(e.reason)})),t.length&&this.afterSuccessfulLoad(t),s.length&&this.afterUnsuccessfulLoad(s)}},{key:"afterSuccessfulLoad",value:function(e){var t=this;e.forEach((function(e){e.classList.remove(t.options.loadClass),e.classList.add(t.options.loadedClass)}))}},{key:"afterUnsuccessfulLoad",value:function(e){var t=this;e.forEach((function(e){e.classList.remove(t.options.loadClass),e.classList.add(t.options.errorClass)}))}},{key:"update",value:function(e){e?(this.elements=e,this.updateIntersectionObserver(e)):(this.elements=this.getElements(),this.updateIntersectionObserver(this.elements))}},{key:"reset",value:function(){this.resetIntersectionObserver()}},{key:"destroy",value:function(){this.destroyIntersectionObserver(),delete this.container,delete this.elements,delete this.options}},{key:"init",value:function(){this.createIntersectionObserver(),this.updateIntersectionObserver(this.elements)}}])&&e(n.prototype,i),o&&e(n,o),r}()}));
